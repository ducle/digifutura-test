<input id="fileupload" type="file" data-parent-id="<%= @file_node.try(:id) %>" multiple="false">

<script>
  $(function () {
      $('#fileupload').fileupload({
          url: "<%= upload_nodes_path %>",
          dataType: 'json',
          type: 'POST',
          multipart: true,
          formData: {parent_id: $('#fileupload').data('parentId')},
          add: function (e, data) {
            data.context = $('p').text('Uploading...').appendTo(document.body);
            data.submit();
          },
          done: function (e, data) {
            if(data.result.status == 'OK'){
              $("#flash-messages").html("<div class='alert alert-success fade in'><a href='#'' class='close' data-dismiss='alert'>&times;</a><strong>Success!</strong> File has been uploaded.</div>")
            } else {
              $("#flash-messages").html("<div class='alert alert-danger fade in'><a href='#'' class='close' data-dismiss='alert'>&times;</a><strong>Error!</strong>"+data.result.message+"</div>")
            }
            location.reload();
          }
      });
  });
</script>
