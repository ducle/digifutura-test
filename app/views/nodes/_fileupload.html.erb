<input id="fileupload" type="file" data-parent-id="<%= @file_node.try(:id) %>" multiple="false">

<script>
  $(function () {
      $('#fileupload').fileupload({
          url: "<%= upload_nodes_path %>",
          dataType: 'json',
          type: 'POST',
          multipart: true,
          formData: {parent_id: $('#fileupload').data('parentId')},
          add: function (e, data) {
            data.context = $('p').text('Uploading...').appendTo(document.body);
            data.submit();
          },
          done: function (e, data) {
            console.log(data);
            console.log(data.result);
            data.context.text('Upload finished.');
          }
      });
  });
</script>
